{% extends "cv/cvbase.html" %}

{% block title %}{{ person.name }}{% endblock %}


{% block topmenu %}
	<a href="/cv/" class="button">Back to CV-list</a>
	<a href="/admin/cv/cv/{{ cv.id }}/" class="button">Edit CV</a>
	<a href="/admin/cv/cv/{{ cv.id }}/" class="button">Edit Person</a>
	<a class="button" onClick="document.cvjsonform.cvjson.value=FormatJSON($('#cvform').serializeObject());document.cvjsonform.submit();">Lag ODT</a>
	<br/>
	<br/>
	<p>Her kan du gjøre justeringer på CVens innhold. Disse endringene blir ikke lagret i databasen, men blir med når du genererer ODT-filen.</p>
{% endblock %}

{% block content %}
		<style>
			input {border:none; width: 90%;}
			
			textarea, 
			pre {
			  margin: 0;
			  padding: 0;
			  outline: 0;
			  border: 0;
			}
			
			.expandingArea {
			  position: relative;
			}
			
			.expandingArea > textarea,
			.expandingArea > pre {
			  background: white;
			  font: 400 13px/16px helvetica, arial, sans-serif;
			  /* Make the text soft-wrap */
			  white-space: pre-wrap;
			  word-wrap: break-word;
			}
			.expandingArea > textarea {
			  /* The border-box box model is used to allow
			   * padding whilst still keeping the overall width
			   * at exactly that of the containing element.
			   */
			  -webkit-box-sizing: border-box;
				 -moz-box-sizing: border-box;
				  -ms-box-sizing: border-box;
					  box-sizing: border-box;
			  width: 100%;
			  /* This height is used when JS is disabled */
			  height: 100px;
			}
			.expandingArea.active > textarea {
			  /* Hide any scrollbars */
			  overflow: hidden;
			  position: absolute;
			  top: 0;
			  left: 0;
			  height: 100%;
			  /* Remove WebKit user-resize widget */
			  resize: none;
			}
			.expandingArea > pre {
			  display: none;
			}
			.expandingArea.active > pre {
			  display: block;
			  /* Hide the text; just using it for sizing */
			  visibility: hidden;
			}
			
		</style>
		<script>
		$(function () {
			 function makeExpandingArea(container) {
			 var area = container.querySelector('textarea');
			 var span = container.querySelector('span');
			 if (area.addEventListener) {
			   area.addEventListener('input', function() {
				 span.textContent = area.value;
			   }, false);
			   span.textContent = area.value;
			 } else if (area.attachEvent) {
			   // IE8 compatibility
			   area.attachEvent('onpropertychange', function() {
				 span.innerText = area.value;
			   });
			   span.innerText = area.value;
			 }
			 // Enable extra CSS
			 container.className += ' active';
			}

			var areas = document.querySelectorAll('.expandingArea');
			var l = areas.length;

			while (l--) {
			 makeExpandingArea(areas[l]);
			}
		});
		</script>
		
		<form action="" method="post" name="cvform" id="cvform" target="_blank">
		<div class="part">
		  <img src="{% if p.image %}{{ p.image.url }}{% endif %}" class="left" id="photo">
		  <input type="hidden" name="photo" value="{{ p.photo }}"/>
		  <div class="bigbox">
			  <input type="text" name="name" value="{{ p.name }}" class="h1"/><br/>
			  <input type="text" name="title" value="{{ cv.title }}" class="h2"/>
			  <p>
			  <input type="text" name="phone" value="{{ p.phone }}"/>
			  <input type="text" name="mail" value="{{ p.mail }}"/>
			  </p>
		  </div>
		</div>

		<div class="part">
		  <h3 class="left">{{ l.profile }}</h3>
		  <div class="bigbox">
			<div class="expandingArea"><pre><span></span><br></pre>
			  <textarea class="profile" name="profile">{{ cv.profile }}</textarea>
			</div>	
		  </div>
		</div>
		
		<div class="part" id="technology">
		{% for te in t %}
			<div class="techset">
				<input type="text" name="technology[{{ forloop.counter }}][title]" value="{{ te.title }}" class="h5 left"/>
				<div class="bigbox">
					<div class="expandingArea"><pre><span></span><br></pre>
					  <textarea name="technology[{{ forloop.counter }}][data]" id="technology[{{ forloop.counter }}][data]">{{ te.data }}</textarea>
					</div>	
				</div>
			</div>
		{% endfor %}
		</div>
		
		<div class="part">
			<h3 class="left">{{ l.experience }}</h3>
			<div class="bigbox" id="sortwithin">
				{% for ex in e|dictsortreversed:"from_year" %}
					<div class="portlet">
						<div class="toggle"></div>
						<input type="text" name="experience[{{ forloop.counter }}][title]" value="{{ ex.title }}" class="h4"/>
						<input type="text" name="experience[{{ forloop.counter }}][years]" value="{{ ex.from_year }}" class="year"/>
						<input type="text" name="experience[{{ forloop.counter }}][company]" value="{{ ex.company }}" class="workplace"/>
						<div class="expandingArea"><pre><span></span><br></pre>
						  <textarea name="experience[{{ forloop.counter }}][description]" id="experience[{{ forloop.counter }}][description]">{{ ex.description }}</textarea>
						</div>	
						<input type="text" name="experience[{{ forloop.counter }}][techs]" value="{{ ex.techs }}" class="techs"/>
					</div>
				{% endfor %}
			</div>
		</div>

		<div class="part">
			<h3 class="left">{{ l.workplace }}</h3>
			<div class="bigbox" id="sortwithin">
				{% for wp in w|dictsortreversed:"from_year" %}
					<section>
						<input type="text" name="workplace[{{ forloop.counter }}][company]" value="{{ wp.company }}" class="h4"/>
						<input type="text" name="workplace[{{ forloop.counter }}][years]" value="{{ wp.from_year }}" class="year"/>
						<input type="text" name="workplace[{{ forloop.counter }}][title]" value="{{ wp.title }}" class="workplace"/>
						<div class="expandingArea"><pre><span></span><br></pre>
						  <textarea name="workplace[{{ forloop.counter }}][description]" id="workplace[{{ forloop.counter }}][description]">{{ wp.description }}</textarea>
						</div>	
					</section>
				{% endfor %}
			</div>
		</div>
		
		<div class="part job">
		<h3 class="left">{{ l.education }}</h3>
		  <div class="bigbox">
			{% for du in d|dictsortreversed:"from_year" %}
			  <section>
					<input type="text" name="education[{{ forloop.counter }}][title]" value="{{ du.title }}" class="h4"/>
					<input type="text" name="education[{{ forloop.counter }}][years]" value="{{ du.from_year }}" class="year"/>
					<input type="text" name="education[{{ forloop.counter }}][school]" value="{{ du.school }}" class="workplace"/>
					<div class="expandingArea"><pre><span></span><br></pre>
					  <textarea name="education[{{ forloop.counter }}][description]" id="education[{{ forloop.counter }}][description]">{{ du.description }}</textarea>
					</div>	
			  </section>
			{% endfor %}
		  </div>
		</div>
		
		<div class="part">
			{% for ot in o %}
			<div class="other">
				<input type="text" name="other[{{ forloop.counter }}][title]" value="{{ ot.title }}" class="h5 left"/>
				<div class="bigbox">
					<div class="expandingArea"><pre><span></span><br></pre>
					  <textarea name="other[{{ forloop.counter }}][data]" id="other[{{ forloop.counter }}][data]">{{ ot.data }}</textarea>
					</div>	
				</div>
			</div>
			{% endfor %}
		</div>
		</form>
		
		<form action="/cv/{{ cv.id }}/odt/" method="post" name="cvjsonform" id="cvjsonform">
			{% csrf_token %}
			<textarea name="cvjson" id="cvjson" style="display:none;"></textarea>
		</form>
		
{% endblock %}