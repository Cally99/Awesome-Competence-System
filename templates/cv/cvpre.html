{% extends "cv/cvprebase.html" %}
{% load image_tags %}
{% block title %}{{ person.name }}{% endblock %}


{% block topmenu %}
	<a href="/cv/" class="button">Back to CV-list</a>
{% if user.is_authenticated %}
	<a href="/admin/cv/cv/{{ cv.id }}/" class="button">Edit CV</a>
	<a href="/admin/cv/person/{{ p.id }}/" class="button">Edit Person</a>
{% endif %}
	<script>
		function dl(format) {
			document.cvjsonform.cvjson.value=FormatJSON($('#cvform').serializeObject());
			document.cvjsonform.action = "/cv/{{ cv.id }}/download/" + format + "/";
			document.cvjsonform.submit();
		}
	</script>
	<a class="button" onClick="dl('odt');">Download .odt</a>
	<a class="button" onClick="dl('doc');">Download .doc</a>
	<a class="button" onClick="dl('pdf');">Download .pdf</a>
{% if user.is_authenticated %}
	<br/>
	<br/>
	<p>Her kan du gjøre justeringer på CVens innhold. Disse endringene blir ikke lagret i databasen, men blir med når du genererer ODT-filen.</p>
{% endif %}
{% endblock %}


{% block content %}

		<style>
			input {border:none; width: 90%;}
			
			textarea, 
			pre {
			  margin: 0;
			  padding: 0;
			  outline: 0;
			  border: 0;
			}
			
			.expandingArea {
			  position: relative;
			}
			
			.expandingArea > textarea,
			.expandingArea > pre {
			  background: transparent;
			  font: 400 13px/16px helvetica, arial, sans-serif;
			  /* Make the text soft-wrap */
			  white-space: pre-wrap;
			  word-wrap: break-word;
			}
			.expandingArea > textarea {
			  /* The border-box box model is used to allow
			   * padding whilst still keeping the overall width
			   * at exactly that of the containing element.
			   */
			  -webkit-box-sizing: border-box;
				 -moz-box-sizing: border-box;
				  -ms-box-sizing: border-box;
					  box-sizing: border-box;
			  width: 90%;
			  /* This height is used when JS is disabled */
			  height: 100px;
			}
			.expandingArea.active > textarea {
			  /* Hide any scrollbars */
			  overflow: hidden;
			  position: absolute;
			  top: 0;
			  left: 0;
			  height: 100%;
			  /* Remove WebKit user-resize widget */
			  resize: none;
			}
			.expandingArea > pre {
			  display: none;
			}
			.expandingArea.active > pre {
			  display: block;
			  /* Hide the text; just using it for sizing */
			  visibility: hidden;
			}
			input[type=text] {background: transparent;}
		</style>
		
		<form action="" method="post" name="cvform" id="cvform" target="_blank">
		<div class="part">
		  <img src="{% if p.image %}{{ p.image|scale:"110x110" }}{% endif %}" class="left" id="photo">
		  <input type="hidden" name="userid" value="{{ p.id }}"/>
		  <input type="hidden" name="photo" value="{% if p.image %}{{ p.image|scale:"110x110" }}{% endif %}"/>
		  <div class="bigbox">
			  <input type="text" name="name" value="{{ p.name }}" class="h1"/><br/>
			  <input type="text" name="title" value="{{ cv.title }}" class="h2"/>
			  <p>
			  <input type="text" name="phone" value="{{ p.phone }}"/>
			  <input type="text" name="mail" value="{{ p.mail }}"/>
			  <input type="text" name="age" value="{{ p.age }}"/>
			  </p>
		  </div>
		</div>

		<div class="part">
		  <h3 class="left">{{ l.profile }}</h3>
		  <div class="bigbox">
			<div class="expandingArea"><pre><span></span><br></pre>
			  <textarea class="profile" name="profile">{{ cv.profile }}</textarea>
			</div>	
		  </div>
		</div>
		
		<div class="part sortwithin">
		{% for te in t %}
			<div class="techset">
				<div class="toggle"></div>
				<div class="expandingArea" style="width:17%; float: left;"><pre><span></span><br></pre>
				  <textarea name="technology[{{ forloop.counter }}][title]" id="technology[{{ forloop.counter }}][title]" class="h5 left">{{ te.title }}</textarea>
				</div>
				<div class="bigbox">
					<div class="expandingArea"><pre><span></span><br></pre>
					  <textarea name="technology[{{ forloop.counter }}][data]" id="technology[{{ forloop.counter }}][data]">{{ te.data }}</textarea>
					</div>	
				</div>
			</div>
		{% endfor %}
		</div>
		
		<div class="part">
			<h3 class="left">{{ l.experience }}</h3>
			<div class="bigbox sortwithin">
				{% for ex in e|dictsortreversed:"from_ym" %}
					<section>
						<div class="toggle"></div>
						<input type="text" name="experience[{{ forloop.counter }}][title]" value="{{ ex.title }}" class="h4"/>
						<input type="text" name="experience[{{ forloop.counter }}][years]" value="{{ ex.from_year }}{% if ex.from_month %} {{ ex.from_monthname }}{% endif %}{% if ex.to_year %} - {{ ex.to_year }}{% endif %}{% if ex.to_month %} {{ ex.to_monthname }}{% endif %}" class="year"/>
						<input type="text" name="experience[{{ forloop.counter }}][company]" value="{{ ex.company }}" class="workplace"/>
						<div class="expandingArea"><pre><span></span><br></pre>
						  <textarea name="experience[{{ forloop.counter }}][description]" id="experience[{{ forloop.counter }}][description]">{{ ex.description }}</textarea>
						</div>	
						<input type="text" name="experience[{{ forloop.counter }}][techs]" value="{{ ex.techs }}" class="techs"/>
					</section>
				{% endfor %}
			</div>
		</div>

		<div class="part">
			<h3 class="left">{{ l.workplace }}</h3>
			<div class="bigbox sortwithin">
				{% for wp in w|dictsortreversed:"from_ym" %}
					<section>
						<div class="toggle"></div>
						<input type="text" name="workplace[{{ forloop.counter }}][company]" value="{{ wp.company }}" class="h4"/>
						<input type="text" name="workplace[{{ forloop.counter }}][years]" value="{{ wp.from_year }}{% if wp.from_month %} {{ wp.from_monthname }}{% endif %}{% if wp.to_year %} - {{ wp.to_year }}{% endif %}{% if wp.to_month %} {{ wp.to_monthname }}{% endif %}" class="year"/>
						<input type="text" name="workplace[{{ forloop.counter }}][title]" value="{{ wp.title }}" class="workplace"/>
						<div class="expandingArea"><pre><span></span><br></pre>
						  <textarea name="workplace[{{ forloop.counter }}][description]" id="workplace[{{ forloop.counter }}][description]">{{ wp.description }}</textarea>
						</div>	
					</section>
				{% endfor %}
			</div>
		</div>
		
		<div class="part job">
		<h3 class="left">{{ l.education }}</h3>
		  <div class="bigbox sortwithin">
			{% for du in d|dictsortreversed:"from_ym" %}
			  <section>
					<div class="toggle"></div>
					<input type="text" name="education[{{ forloop.counter }}][title]" value="{{ du.title }}" class="h4"/>
					<input type="text" name="education[{{ forloop.counter }}][years]" value="{{ du.from_year }}{% if du.from_month %} {{ du.from_monthname }}{% endif %}{% if du.to_year %} - {{ du.to_year }}{% endif %}{% if du.to_month %} {{ du.to_monthname }}{% endif %}" class="year"/>
					<input type="text" name="education[{{ forloop.counter }}][school]" value="{{ du.school }}" class="workplace"/>
					<div class="expandingArea"><pre><span></span><br></pre>
					  <textarea name="education[{{ forloop.counter }}][description]" id="education[{{ forloop.counter }}][description]">{{ du.description }}</textarea>
					</div>	
			  </section>
			{% endfor %}
		  </div>
		</div>
		
		<div class="part sortwithin">
			{% for ot in o %}
			<div class="other">
				<div class="toggle"></div>
				<div class="expandingArea" style="width:17%; float: left;"><pre><span></span><br></pre>
				  <textarea name="other[{{ forloop.counter }}][title]" id="other[{{ forloop.counter }}][title]" class="h5 left">{{ ot.title }}</textarea>
				</div>
				<div class="bigbox">
					<div class="expandingArea"><pre><span></span><br></pre>
					  <textarea name="other[{{ forloop.counter }}][data]" id="other[{{ forloop.counter }}][data]">{{ ot.data }}</textarea>
					</div>	
				</div>
			</div>
			{% endfor %}
		</div>
		</form>
		
		<form action="/cv/{{ cv.id }}/odt/" method="post" name="cvjsonform" id="cvjsonform">
			{% csrf_token %}
			<textarea name="cvjson" id="cvjson" style="display:none;"></textarea>
		</form>
		
{% if user.is_anonymous %}
	<script>
		$(function() {
			$('textarea,input[type=text]').prop('disabled', true);
			$('#cvjson').prop('disabled',false);
			$('.toggle').remove();
		});
	</script>
{% endif %}


{% if False %}

		<div class="part">
		  <p class="contact">{{ p.phone }}<br/>{{ p.mail }}</p>
		  <img src="{{ p.image|scale:"110x110" }}" class="left" id="photo">
		  <h1>{{ p.name }}</h1>
		  <h2>{{ cv.title }}</h2>
		</div>

		<div class="part">
		  <h3 class="left">{{ l.profile }}</h3>
		  <div class="bigbox">
			<p class="profile">{{ cv.profile }}</p>
		  </div>
		</div>
		
		<div class="part">
		{% for te in t %}
			<div class="techset">
				<h5 class="left">{{ te.title }}</h5>
				<div class="bigbox">
				<p>{{ te.data }}</p>
				</div>
			</div>
		{% endfor %}
		</div>
		
		<div class="part">
			<h3 class="left">{{ l.experience }}</h3>
			<div class="bigbox">
				{% for ex in e %}
					<div class="portlet">
						<div class="toggle"></div>
						<h4>{{ ex.title }}</h4>
						<p class="year">{{ ex.years }}</p>
						<p class="workplace">{{ ex.company }}</p>
						<p>{{ ex.description }}</p>
						<p class="techs">{{ ex.techs }}</p>
					</div>
				{% endfor %}
			</div>
		</div>

		<div class="part">
			<h3 class="left">{{ l.workplace }}</h3>
			<div class="bigbox">
				{% for wp in w %}
					<section>
					  <h4>{{ wp.company }}</h4>
					  <p class="year">{{ wp.years }}</p>
					  <p class="workplace">{{ wp.title }}</p>
						<p>{{ wp.description }}</p>
					</section>
				{% endfor %}
			</div>
		</div>
		
		<div class="part job">
		<h3 class="left">{{ l.education }}</h3>
		  <div class="bigbox">
			{% for du in d %}
			  <section>
				  <h4>{{ du.title }}</h4>
				  <p class="year">{{ du.years }}</p>
				  <p class="workplace">{{ du.school }}</p>
						<p>{{ du.description }}</p>
			  </section>
			{% endfor %}
		  </div>
		</div>
		
		<div class="part">
			{% for ot in o %}
			<div class="other">
			<h5 class="left">{{ ot.title }}</h5>
				<div class="bigbox">
					<ul>
						{{ ot.data_as_list|unordered_list }}
					</ul>
				</div>
			</div>
			{% endfor %}
		</div>

{% endif %}

{% endblock %}