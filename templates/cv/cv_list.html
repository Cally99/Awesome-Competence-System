{% extends "./cvbase.html" %}
{% load image_tags %}

{% block title %}CV{% endblock %}

{% block actions %}
	{% if user.is_authenticated %}
		<h1>Altran CV</h1>
		<input type="text" name="filter" id="filter" size="10" style="margin:0;" placeholder="Search"/>
		{% if user.is_authenticated %}
			<a href="{% url admin:cv_person_add %}" class="butt">Add new person</a>
		{% endif %}
	{% endif %}
{% endblock %}

{% block content %}

	<script>
		$(function() {
			var filterTxt;
			$('#filter').keyup( function(event) {
				filterTxt = $(this).val();
				$('.block').addClass('hidden');
				$('.tags')
					.filter( function(index) {
						return $(this).text().toLowerCase().indexOf(filterTxt.toLowerCase()) >= 0;
					})
					.parent().parent().removeClass('hidden');
			});
		});
	</script>

	{% if all_persons %}
		{% for p in all_persons|dictsort:"name" %}
			<div class="block tiled">
			
				<header>
					<h3>{{ p.name }}</h3>
					<h4>{% if p.title %}{{ p.title }}{% else %} ---{% endif %}</h4>
				</header>
				{% if p.image %}
					<img src="{{ p.image|scale:"110x110" }}" class="photo" style="float: left;">
				{% endif %}
				<div class="completeness">
					<div class="percent{% if p.completeness.percent < 100 %} redpercent{% endif %}" style="width: {{ p.completeness.percent }}%;"></div>
				</div>
				<section>
					{% if user.is_authenticated %}
						<p class="majordetail">
							<acronym title="{{ p.completeness.comment }}">Profile {{ p.completeness.percent }}% complete</acronym>
						</p>
						<p class="minordetail">
							Updated: {{ p.last_edited|date:"SHORT_DATE_FORMAT" }}
						</p>
					{% else %}
						<p class="minordetail">{{ p.phone }}<br/>
						{{ p.mail }}</p>
					{% endif %}
					<a href="{% url admin:cv_person_change p.id %}" class="butt">Edit person</a>
					<p class="tags">
						{{ p.name }}
						{% for t in p.technology_set.all %}{{t.data}}{{t.data_en}}{% endfor %}
						{% for e in p.experience_set.all %}{{e.techs}}{{e.company}}{{e.company_en}}{% endfor %}
						{% for w in p.workplace_set.all %}{{w.company}}{{w.company_en}}{% endfor %}
						{% for s in p.education_set.all %}{{s.school}}{{s.school_en}}{% endfor %}
						{% for c in p.cv_set.all %}{{c.title}}{{c.title_en}}{% endfor %}
						{{ p.phone }}
						{{ p.title }}
					</p>
				</section>

				<div class="cvset">
					<table>
					{% for cv in p.cv_set.all|dictsortreversed:"cvsort" %}
						{% if user.is_anonymous and cv.tags == "Empty CV" %}
						{% else %}
						<tr>
							<td><a href="{% url cv_detail cv.id %}" class="butt bigbutt{% if not cv.is_recent or not cv.status.complete and cv.tags != "Empty CV" %} red{% endif %}{% if cv.tags = "Empty CV" %} empty{% endif %}" title="{{ cv.status.comment }}">{{ cv.tags }}<br/>
							<span class="dato">{% if cv.tags != "Empty CV" %}{{ cv.last_edited|date:"SHORT_DATE_FORMAT" }} <span class="completeness"><span class="percent{% if cv.status.percent < 100 %} redpercent{% endif %}" style="width: {{ cv.status.percent }}%;"></span></span> {{ cv.status.percent }}%{% else %}&nbsp;{% endif %}</span></a></td>
							{% if user.is_authenticated %}
								<td><a href="{% url admin:cv_cv_change cv.id %}" class="butt{% if not cv.is_recent %} red{% endif %}">Edit<br/>
								<span class="dato"> &nbsp;</span></a></td>
							{% endif %}
						</tr>
						{% endif %}
					{% endfor %}
					</table>
				</div>
				
			</div>
		{% endfor %}

{% comment %}
	{% for i in "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" %}
	<div class="block tiled"><h3>Dummy {{ forloop.counter0 }}</h3><div><p class="tags">Leon Ho test Objekt-orientering. Metodearbeid. Cloud Computing. Distribuerte systemer. Planleggingssystemer. Automatisering av EDB baserte arbeidsrutiner for brukere. Datasikkerhet. Lede team i Objekt-orientert softwareutvikling. Prosjektleder, mentor, software arkitekt, teknologir√•dgiver og kursholder. Java, J2EE, EJB, JMS, J2SE, J2ME, CORBA/DCOM, Jini/JavaSpaces, Scrummaster, UML, Rational Unified Process, C++ og Smalltalk. {{ forloop.counter0 }}</p></div></div>
	{% endfor %}
{% endcomment %}

	{% else %}
		<div class="block">
			<p>Her er det ingen CVer, dessverre!</p>
		</div>
	{% endif %}

	<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>

	<script>
	$(function() {
		var filterTxt;
		$('#filter').keyup( function(event) {
			filterTxt = $(this).val();
			$('.person').addClass('hidden');
			$('.techs')
				.filter( function(index) {
					return $(this).text().toLowerCase().indexOf(filterTxt.toLowerCase()) >= 0;
				})
				.parent().parent().removeClass('hidden');
		});
	});
	</script>

	<script>
	$("input").change(function () {
		var isChecked = this.checked;
		var thisId = this.id;
		$('a').each(function(i, t) {
		
			var tempUrl = $(this).attr('href');
			
			if(isChecked) {
			
				switch(thisId) {
				case 'eng':
					tempUrl += 'eng/';
					break;
				case 'doc':
					tempUrl += 'doc/';
					break;
				}
				
			} else {
			
				switch(thisId) {
				case 'eng':
					tempUrl = tempUrl.replace(/\/eng\//, "/");
					break;
				case 'doc':
					tempUrl = tempUrl.replace(/\/doc\//, "/");
					break;
				}
				
			}
			
		  $(this).attr('href', tempUrl);
		  
		});
	});
	</script>

{% endblock %}